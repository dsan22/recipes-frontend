<div class="pt-10">
  <form
    class="max-w-4xl mx-auto p-8 bg-white rounded-2xl shadow-lg space-y-8"
    [formGroup]="editForm"
  >
    <!-- Title -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <h1 class="text-4xl font-extrabold text-gray-800">Edit Recipe</h1>
    </div>

    <!-- Recipe Info -->
    <div class="grid sm:grid-cols-2 gap-6">
      <div>
        <label class="block text-gray-700 text-sm font-bold mb-2">Name</label>
        <input
          formControlName="name"
          placeholder="Enter recipe name"
          class="border border-gray-300 rounded-lg w-full py-2.5 px-4 text-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-400 transition shadow-sm"
        />
      </div>

      <div>
        <label class="block text-gray-700 text-sm font-bold mb-2">Description</label>
        <input
          formControlName="description"
          placeholder="Short recipe description"
          class="border border-gray-300 rounded-lg w-full py-2.5 px-4 text-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-400 transition shadow-sm"
        />
      </div>
    </div>

    <div class="border-t border-gray-200 pt-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
        Images
      </h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 my-4">

    <!-- Add New Image Button -->
    <button
      (click)="openAddImageModal()"
      class="border-2 border-dashed border-gray-300 rounded-xl h-32 flex flex-col items-center justify-center hover:bg-gray-100 transition"
    >
      <span class="text-3xl">+</span>
      <span class="text-sm text-gray-500">Add Image</span>
    </button>

    <!-- Existing images -->
    <div
      *ngFor="let img of recipe.images"
      class="relative h-32 rounded-xl overflow-hidden group shadow-md"
    >
      <img
        [src]="img"
        class="w-full h-full object-cover"
      />

      <!-- Delete Button -->
      <button
        (click)="deleteImage(img)"
        class="absolute top-2 right-2 bg-black/60 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition"
      >
        ✕
      </button>

      <!-- Set as cover -->
      <button
        *ngIf="!img.is_cover"
        (click)="setAsCover(img)"
        class="absolute bottom-2 left-2 bg-white/80 shadow text-xs px-2 py-1 rounded-full opacity-0 group-hover:opacity-100 transition"
      >
        Set Cover
      </button>

      <!-- Cover Badge -->
      <span
        *ngIf="img.is_cover"
        class="absolute bottom-2 left-2 bg-orange-500 text-white text-xs px-2 py-1 rounded-full shadow"
      >
        Cover
      </span>

    </div>

  </div>

  <!-- Modal -->

  @if (showImageModal) {
    <app-recipe-image-form-modal
      (close)="closeImageModal()"
      (save)="onSaveImage($event)"
    />
  }
</div>
    <!-- Ingredients -->
    <div class="border-t border-gray-200 pt-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
        Ingredients
      </h2>

      <div formArrayName="ingredients" class="space-y-5">
        @for (ingredientGroup of ingredientForms.controls; track $index; let i = $index) {
          <div
            [formGroupName]="i"
            class="p-5 bg-gray-50 border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition"
          >
            <input type="hidden" formControlName="id" />

            <div class="flex flex-col sm:flex-row sm:items-end gap-4">
              <div class="flex-grow">
                <label class="block text-gray-700 text-xs font-bold mb-1">Name</label>
                <input
                  formControlName="name"
                  placeholder="e.g., Flour"
                  class="border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 text-sm focus:ring-2 focus:ring-orange-400 focus:outline-none transition shadow-inner"
                />
              </div>

              <div class="sm:w-1/3">
                <label class="block text-gray-700 text-xs font-bold mb-1">Amount</label>
                <input
                  formControlName="amount"
                  placeholder="e.g., 2 cups"
                  class="border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 text-sm focus:ring-2 focus:ring-orange-400 focus:outline-none transition shadow-inner"
                />
              </div>

              <button
                (click)="deleteIngredientForm(i)"
                type="button"
                class="bg-red-500 hover:bg-red-600 text-white text-sm font-semibold py-2 px-3 rounded-md shadow-sm transition focus:ring-2 focus:ring-red-400"
              >
                Remove
              </button>
            </div>
          </div>
        }
      </div>

      <button
        (click)="addIngredientForm()"
        type="button"
        class="mt-5 w-full bg-gradient-to-r from-blue-500 to-sky-500 hover:from-blue-600 hover:to-sky-600 text-white font-semibold py-2.5 px-4 rounded-lg shadow-md hover:shadow-lg transition"
      >
        Add Ingredient
      </button>
    </div>

    <!-- Instructions -->
    <div class="border-t border-gray-200 pt-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
        Instructions
      </h2>

      <div
        formArrayName="instructions"
        cdkDropList
        (cdkDropListDropped)="dropInstruction($event)"
        class="space-y-5"
      >
        @for (instructionGroup of instructionForms.controls; track instructionGroup; let i = $index) {
            <div
                [formGroupName]="i"
                cdkDrag
                class="p-5 bg-gray-50 border border-gray-200 rounded-xl flex items-center gap-4 shadow-sm hover:shadow-md transition"
            >
                <input type="hidden" formControlName="id" />
                <input type="hidden" formControlName="step" />

                <!-- Drag Handle -->
                <div
                cdkDragHandle
                class="cursor-grab text-gray-400 hover:text-gray-700 text-xl select-none"
                title="Drag to reorder"
                >
                ☰
                </div>

                <!-- Input Section -->
                <div class="flex-grow flex flex-col sm:flex-row sm:items-center sm:gap-3">
                    <h3 class="text-sm font-semibold text-gray-700 min-w-[75px]">
                        Step #{{ i + 1 }}
                    </h3>
                    <input
                        formControlName="instruction"
                        placeholder="e.g., Preheat the oven to 180°C"
                        class="border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 text-sm focus:ring-2 focus:ring-orange-400 focus:outline-none transition shadow-inner"
                    />
                </div>

                <!-- Delete -->
                    <button
                        (click)="deleteInstructionForm(i)"
                        type="button"
                        class="bg-red-500 hover:bg-red-600 text-white text-sm font-semibold py-2 px-3 rounded-md shadow-sm transition focus:ring-2 focus:ring-red-400"
                    >
                        Remove
                    </button>
            </div>
        }
        </div>

      <button
        (click)="addInstructionForm()"
        type="button"
        class="mt-5 w-full bg-gradient-to-r from-blue-500 to-sky-500 hover:from-blue-600 hover:to-sky-600 text-white font-semibold py-2.5 px-4 rounded-lg shadow-md hover:shadow-lg transition"
      >
        Add Instruction
      </button>
    </div>
    <div class="border-t border-gray-200 pt-8 flex justify-center items-center gap-6">
        <button
            type="submit"
            (click)="submit()"
            [disabled]="editForm.invalid"
            class="w-1/2 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md hover:shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
            Save Changes
        </button>

        <button
            (click)="cancel()"
            type="button"
            class="w-1/2 bg-red-500 hover:bg-red-600 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md hover:shadow-lg transition focus:ring-2 focus:ring-red-400"
        >
            Cancel
        </button>
    </div>

  </form>
</div>
